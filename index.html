<!DOCTYPE html>
<!-- D√©finit le type de document comme HTML5 -->
<html lang="fr">
  <!-- Indique que la langue principale du document est le fran√ßais -->
  <head>
    <meta charset="UTF-8" />
    <!-- D√©finit l'encodage des caract√®res en UTF-8 -->
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <!-- Rend la page responsive -->
    <title>Gestion du Temps - M√©thode Boclet</title>
    <!-- Titre de la page -->
    <style>
      :root {
        /* D√©claration de variables CSS globales */
        --blue-fluo: #00bfff; /* Couleur bleu fluo */
        --green-fluo: #39ff14; /* Couleur vert fluo */
        --gray: #2f2f2f; /* Gris fonc√© principal */
        --bg: #1c1c1c; /* Couleur de fond g√©n√©rale */
        --text: #f0f0f0; /* Couleur du texte principale */
        --radius: 12px; /* Rayon d‚Äôarrondi pour les √©l√©ments */
      }

      body {
        /* Styles du corps de la page */
        font-family: "Poppins", sans-serif; /* Police moderne */
        background-color: var(--bg); /* Fond gris fonc√© */
        color: var(--text); /* Texte clair */
        margin: 0; /* Supprime les marges par d√©faut */
        padding: 2rem 1rem; /* Espace int√©rieur */
        display: flex; /* Active le mode flexbox */
        flex-direction: column; /* Disposition verticale */
        align-items: center; /* Centre les √©l√©ments horizontalement */
      }

      h2 {
        /* Titre principal */
        color: var(--green-fluo); /* Couleur vert fluo */
        text-shadow: 0 0 8px var(--green-fluo); /* Effet lumineux vert */
        text-align: center; /* Centrage du texte */
        margin-bottom: 1.5rem; /* Espace en dessous */
      }

      .container {
        /* Conteneur principal des cat√©gories */
        background: var(--gray); /* Fond gris */
        padding: 1.5rem; /* Espacement interne */
        border-radius: var(--radius); /* Coins arrondis */
        box-shadow: 0 0 15px rgba(0, 255, 255, 0.2); /* L√©g√®re ombre bleut√©e */
        max-width: 600px; /* Largeur max */
        width: 100%; /* Prend toute la largeur disponible */
      }

      .category {
        /* Chaque bloc de cat√©gorie */
        display: flex; /* Mode flexbox */
        justify-content: space-between; /* Espace entre les √©l√©ments */
        align-items: center; /* Aligne verticalement au centre */
        padding: 0.75rem; /* Espacement interne */
        border-bottom: 1px solid rgba(255, 255, 255, 0.1); /* Ligne de s√©paration */
        flex-wrap: wrap; /* Permet le retour √† la ligne si petit √©cran */
      }

      .category:last-child {
        border-bottom: none;
      } /* Supprime la bordure du dernier √©l√©ment */

      .category span {
        /* Label de la cat√©gorie */
        flex: 1 1 100%; /* Prend toute la largeur sur petits √©crans */
        font-weight: 600; /* Texte en gras */
        color: var(--green-fluo); /* Couleur verte */
        margin-bottom: 0.5rem; /* Espacement inf√©rieur */
      }

      .buttons {
        display: flex;
        gap: 0.5rem;
      } /* Boutons align√©s avec un espace */

      button {
        /* Styles g√©n√©raux des boutons */
        padding: 0.5rem 1rem; /* Taille du bouton */
        border: none; /* Pas de bordure */
        border-radius: var(--radius); /* Coins arrondis */
        cursor: pointer; /* Curseur pointeur */
        font-weight: 600; /* Texte en gras */
        transition: all 0.2s; /* Animation fluide au survol */
        color: var(--bg); /* Texte fonc√© */
      }

      button.start {
        background: var(--green-fluo);
      } /* Bouton D√©marrer en vert fluo */
      button.stop {
        background: var(--blue-fluo);
      } /* Bouton Arr√™ter en bleu fluo */

      button:hover {
        /* Effet au survol */
        transform: scale(1.05); /* L√©ger agrandissement */
        filter: brightness(1.2); /* L√©g√®re brillance */
      }

      .time {
        /* Affichage du chronom√®tre */
        font-family: monospace; /* Police √† espacement fixe */
        font-size: 1.1rem; /* Taille du texte */
        color: var(--blue-fluo); /* Couleur bleue */
        margin-left: auto; /* D√©calage √† droite */
      }

      .stats {
        /* Bloc des statistiques */
        margin-top: 2rem; /* Espace au-dessus */
        background: var(--gray); /* Fond gris */
        padding: 1.5rem; /* Espacement interne */
        border-radius: var(--radius); /* Coins arrondis */
        box-shadow: 0 0 10px rgba(0, 255, 255, 0.15); /* L√©g√®re ombre */
        width: 100%; /* Largeur compl√®te */
      }

      .stats h3 {
        /* Titre des stats */
        margin-top: 0; /* Supprime la marge sup√©rieure */
        color: var(--green-fluo); /* Vert fluo */
        text-align: center; /* Centr√© */
      }

      .stats div {
        margin: 0.4rem 0;
      } /* Espace entre lignes des stats */

      .recap-button {
        /* Bouton de r√©capitulatif */
        margin-top: 1rem; /* Espace au-dessus */
        background: var(--blue-fluo); /* Bleu fluo */
        color: var(--bg); /* Texte fonc√© */
        font-size: 1rem; /* Taille de texte */
        padding: 0.6rem 1.2rem; /* Taille du bouton */
        border-radius: var(--radius); /* Coins arrondis */
        cursor: pointer; /* Curseur pointeur */
        transition: 0.3s; /* Animation fluide */
        font-weight: 600; /* Texte en gras */
      }

      .recap-button:hover {
        /* Effet au survol */
        background: var(--green-fluo); /* Passe au vert fluo */
        transform: scale(1.05); /* L√©g√®re mise en avant */
      }

      @media (max-width: 500px) {
        /* Adaptation mobile */
        .category {
          flex-direction: column;
          align-items: flex-start;
        } /* Empile les √©l√©ments */
        .buttons {
          width: 100%;
          justify-content: flex-start;
        } /* Aligne √† gauche */
        .time {
          margin-left: 0;
          margin-top: 0.5rem;
        } /* Ajuste la position du temps */
      }
    </style>
  </head>

  <body>
    <h2>Gestion du Temps - M√©thode Boclet</h2>
    <!-- Titre principal -->

    <div class="container" id="categories"></div>
    <!-- Conteneur o√π seront affich√©es les cat√©gories -->

    <button class="recap-button" onclick="showStats()">üìÖ Voir le r√©capitulatif du jour</button>
    <!-- Bouton pour afficher les stats -->

    <div class="stats" id="stats"></div>
    <!-- Conteneur des statistiques -->

    <script>
      const categories = [
        // Liste des types de temps suivis
        { id: "pro", label: "Temps professionnel" },
        { id: "perso", label: "Temps personnel" },
        { id: "soi", label: "Temps pour soi (apprentissage...)" },
        { id: "oblig", label: "Temps obligatoire (t√¢ches...)" },
        { id: "perdu", label: "Temps perdu" },
      ];

      const today = new Date().toISOString().split("T")[0]; // R√©cup√®re la date du jour au format AAAA-MM-JJ
      const STORAGE_KEY = "gestion_temps_boclet"; // Nom de la cl√© utilis√©e dans le localStorage

      let allData = JSON.parse(localStorage.getItem(STORAGE_KEY)) || {}; // R√©cup√®re les donn√©es existantes du localStorage
      if (!allData[today]) allData[today] = {}; // Si aucune donn√©e pour aujourd‚Äôhui, cr√©e une entr√©e

      let timers = allData[today]; // Charge les timers du jour actuel
      categories.forEach((cat) => {
        // S‚Äôassure que chaque cat√©gorie existe
        if (!timers[cat.id]) timers[cat.id] = { start: null, total: 0 }; // Initialise le chrono si manquant
      });

      let running = null; // Contient l‚ÄôID du chrono en cours

      function saveData() {
        // Sauvegarde les donn√©es dans le localStorage
        allData[today] = timers; // Met √† jour la date du jour
        localStorage.setItem(STORAGE_KEY, JSON.stringify(allData)); // Enregistre le tout en JSON
      }

      function formatTime(sec) {
        // Convertit les secondes en format HH:MM:SS
        const h = Math.floor(sec / 3600); // Heures
        const m = Math.floor((sec % 3600) / 60); // Minutes
        const s = sec % 60; // Secondes
        return `${h.toString().padStart(2, "0")}:${m.toString().padStart(2, "0")}:${s
          .toString()
          .padStart(2, "0")}`; // Retourne le texte format√©
      }

      function renderCategories() {
        // Cr√©e dynamiquement l‚Äôaffichage des cat√©gories
        let html = ""; // Cha√Æne HTML vide
        categories.forEach((cat) => {
          // Pour chaque cat√©gorie...
          html += `
          <div class="category">
            <span>${cat.label}</span>
            <div class="buttons">
              <button class="start" onclick="startTimer('${cat.id}')">‚ñ∂ D√©marrer</button>
              <button class="stop" onclick="stopTimer('${cat.id}')">‚èπ Arr√™ter</button>
            </div>
            <div class="time" id="time-${cat.id}">
              ${formatTime(timers[cat.id]?.total || 0)}
            </div>
          </div>`; // Cr√©e un bloc HTML complet
        });
        document.getElementById("categories").innerHTML = html; // Injecte le HTML dans la page
      }

      function startTimer(cat) {
        // Lance le chronom√®tre d‚Äôune cat√©gorie
        if (running) stopTimer(running); // Stoppe celui d√©j√† en cours s‚Äôil y en a un
        timers[cat].start = Date.now(); // Enregistre le moment de d√©part
        running = cat; // M√©morise la cat√©gorie active
        saveData(); // Sauvegarde
      }

      function stopTimer(cat) {
        // Arr√™te le chronom√®tre d‚Äôune cat√©gorie
        if (timers[cat].start) {
          // V√©rifie qu‚Äôun chrono est actif
          const elapsed = Math.floor((Date.now() - timers[cat].start) / 1000); // Calcule le temps √©coul√©
          timers[cat].total += elapsed; // Ajoute le temps √©coul√© au total
          timers[cat].start = null; // R√©initialise le d√©marrage
          running = null; // Aucune cat√©gorie en cours
          saveData(); // Sauvegarde
        }
      }

      function updateDisplay() {
        // Rafra√Æchit l‚Äôaffichage des temps
        categories.forEach((cat) => {
          // Pour chaque cat√©gorie...
          let t = timers[cat.id].total; // Temps total
          if (timers[cat.id].start) {
            // Si le chrono tourne encore
            t += Math.floor((Date.now() - timers[cat.id].start) / 1000); // Ajoute le temps en cours
          }
          document.getElementById("time-" + cat.id).textContent = formatTime(t); // Met √† jour l‚Äôaffichage
        });
      }

      setInterval(updateDisplay, 1000); // Rafra√Æchit chaque seconde

      function showStats() {
        // Affiche le r√©capitulatif du jour
        if (running) stopTimer(running); // Stoppe le chrono actif
        let total = categories.reduce(
          // Calcule le total de tous les temps
          (acc, cat) => acc + (timers[cat.id]?.total || 0),
          0
        );

        let html = `<h3>R√©capitulatif du ${new Date().toLocaleDateString("fr-FR")}</h3>`; // Ajoute la date du jour
        categories.forEach((cat) => {
          // Pour chaque cat√©gorie...
          const sec = timers[cat.id]?.total || 0; // Temps total en secondes
          const pct = total ? Math.round((sec * 100) / total) : 0; // Pourcentage du total
          html += `<div>${cat.label} : <b>${formatTime(sec)}</b> (${pct}%)</div>`; // Ligne de r√©capitulatif
        });

        document.getElementById("stats").innerHTML = html; // Affiche les r√©sultats dans la div
      }

      renderCategories(); // G√©n√®re les boutons au chargement
      updateDisplay(); // Met √† jour les temps affich√©s imm√©diatement
    </script>
  </body>
</html>
